- ```
  目录
  一、概述
  	- 1）系统日志
  	- 2）操作日志
  二、操作日志字段
  	- 1）字段定义
  	- 2）必要字段说明
  三、用户操作日志具体设计方法
  	- 1）梳理操作模块
  	- 2）梳理记录字段
  	- 3）填充具体规则
  	- 4）权限控制
  	- 5）语义化注解
  	- 6）补充其他附属功能
  鸣谢
  ```
- **一、概述**
	- 日志记录了代码的执行过程。根据目的不同，可分为系统日志和操作日志。
	- **1）系统日志**
		- 记录系统中硬件、软件和系统问题的信息，同时还可以监视系统中发生的事件。开发人员可以通过它来检查错误发生的原因，或者寻找受到攻击时攻击者留下的痕迹。
		- 系统日志包括系统日志、应用程序日志和安全日志。由于系统日志主要是为开发人员排查问题提供依据的，因此可读性没那么高。
	- **2）操作日志**
		- 记录所有用户在系统中的操作过程和操作结果，如登录记录、修改记录等。操作日志主要是为用户服务，帮助他们查看历史操作记录，因此对可读性要求较高。
- **二、操作日志字段**
	- **1）字段定义**
		- 具体而言就是记录“谁在什么时间、什么位置，对什么东西做了什么操作，从而产生了哪些变动”，因此一个完备的操作日志应包含以下信息：
			- ①用户（操作人及账号）：谁执行了该操作；
			- ②操作时间：什么时间执行了该操作；
			- ③操作位置（业务模块）：在哪个模块上执行了该操作；
			- ④操作类型：具体执行了哪个操作，如登录、浏览、新增、删除等；
			- ⑤操作对象类别及对象：对哪个类型的哪个对象执行了该操作；
			- ⑥操作描述/详情：说明或变动值，在执行该操作后产生了哪些变化；
		- 除了以上内容，还可根据业务场景补充记录其他字段：
			- ⑦操作页面：记录执行操作时调用的接口，如/crowd/system/user/list，当出现异常时，便于技术人员快速定位问题；
			- ⑧登录IP：记录用户在何地执行的操作，如125.71.135.54 四川省成都市武侯区电信
			- ⑨设备信息：记录用户通过哪种系统/设备执行的操作，如Chrome101、Windows7、PC；
			- ⑩操作状态：默认只记录操作成功的日志，如果业务需要，还可以增加“操作状态”字段来记录操作失败的日志，同时记录失败原因。
			- 注：还可以增加**业务相关字段**，以满足业务需要而记录的字段；
	- **2）必要字段说明**
		- ①操作位置（业务模块）
			- 根据业务需要筛选出要记录的功能模块，可以以“【一级菜单】【二级菜单】......”方式划分；
		- ②操作类型
			  | 操作类型 | 主要应用 | 举例 |

			  | 登录/退出 | 重要功能，用户操作 | 用户登录系统 |

			  | 增加 | 重要功能、多人协作 | 新增资产、IP、部门/角色/用户... |

			  | 删除 | 重要功能、多人协作 | 删除规划、部门/角色/用户..|

			  | 修改 | 重要功能、多人协作 | 修改资产、IP、上下架设备...|

			  | 查询 | 敏感信息 | 查看公司、供应商... |

			  | 启用/禁用 | 重要功能、多人协作 | 启用/禁用菜单、基础数据项...|

			  | 审核/反审核 | 重要功能、多人协作 | 审核工单、审核出入库...|

			  | 导出 | 敏感信息 | 导出设备、基础数据项... |

			  | 导入 | 敏感信息、多人协作 | 导入设备、IP... |

		- ③操作描述/详情
			- 涉及单/批量对象单/多属性单/多状态操作：{operationType}{objectType}{objectName1、objectName2...}{属性名1、属性名2...}，详情展示“{objectName1}{属性名1:变更前值1->变更后值1....}、{objectName2}{属性名1:变更前值1->变更后值1....}...”；
			- 注解：
				- A.具体可根据业务需求决定日志记录的颗粒度，可只记录到操作类型，也可记录到每次操作的详细内容。
				- B.具体可根据业务需求，针对是否批量、多属性/状态变化等情况进行描述/详情优化；
		- ④属性值（变动值）
			- 日志模块的使用场景不同，要处理的对象（即oldObject和newObject）千奇百怪。故需要自动分析对象的属性不同，然后记录。即将对象拆解开来，逐一对比两个对象（来自同一个类）的各个属性，然后将不同的记录下来。
- **三、用户操作日志具体设计方法**
	- **1）梳理操作模块**
		- 梳理操作列表就是罗列出用户的哪些操作要在用户操作日志中记录。具体的方法是：
			- 在功能列表的基础上，根据业务需要筛选出要记录的功能，操作模块类别命名为“【一级菜单】【二级菜单】......”；
	- **2）梳理记录字段**
		- 明确针对每个操作要记录的字段有哪些。至少应包括用户、操作时间、操作位置、操作对象类别、对象名和操作类型，再根据业务的需要增加变动值、IP地址、设备信息、操作页面、操作状态等其他字段。
	- **3）填充具体规则**
		- 搭建好操作列表和记录字段的框架后，接下来就是往里面填充具体的规则了，即如何将操作日志以通俗易懂的方式展现出来，例如：
			- ①用户（操作人及账号）：{名称}/{账号}
			- ②操作时间：{YYMMDD hh:mm:ss}；
			- ③操作位置（业务模块）：{业务模块}；
			- ④操作类型：{operationType}；
			- ⑤操作对象类别、对象及ID：{objectType}{objectName}（objectId）；
			- ⑥操作描述/详情：
				- A.操作说明：{operationType}{objectType}{objectName}；
				- B.属性:变动值（可能有多个对象属性变化）：{属性名}:{变更前值}->{变更后值}；
		- 除了以上内容，还可根据业务场景补充记录其他字段：
			- ⑦操作页面：记录执行操作时调用的接口，如/crowd/system/user/list，当出现异常时，便于技术人员快速定位问题；
			- ⑧登录IP：{IP}(地址)；
			- ⑨设备信息：{设备系统/设备类型}；
			- ⑩操作状态：{成功/失败}；
	- **4）权限控制**
		- 按实际需要，基于后台系统的操作权限进行权限控制设计。例如，管理员可查看所有用户的所有操作日志，某部门账号仅可查看同部门下所有用户的操作日志。用户的操作跟随登录用户的身份进行记录。
	- **5）语义化注解**
		- 当给用户展示时，用户并不知道对象中属性名的确切含义。因此，我们需要显示其属性别名，以提升其可读性。
	- **6) 补充其他附属功能**
		- 关于用户操作日志，还可根据需要设计其他附属功能，包括：
			- ①查询筛选：为便于用户查找，针对操作字段提供查询和筛选功能，如按用户信息进行模糊搜索、按操作时间段进行查询、按业务菜单和操作类型等进行筛选；
			- ②分页：分页展示数据，并且可以设置每页显示条数。特殊地，需考虑设置刷新机制，防止实时更新记录刷新过快导致分页功能失效；
			- ③排序：支持按操作时间正序或倒序排列；
			- ④自定义显示列字段：若显示的字段太多，可由用户自定义选择；
			- ⑤下载：能够根据条件批量下载用户操作日志；
			- ⑥自动清理：根据业务需要及用户操作日志更新频率，综合操作日志时效特性，设置存储天数或存储条数等限制，以实现自动清理无用日志，下述为通用规则：
				```
				| 设置        | 描述 |

				| 最大存储条数 | 操作日志存储的最大条数。达到最大存储条数时，将自动清理最早的操作日志，默认值: 50,000，最大值: 1,000,000 |

				| 最大存储天数 | 操作日志存储的最大天数。达到最大存储天数时，将自动清理最早的操作日志。默认值: 0，表示无限制 |
				```
- ```
  本文在参考多篇相关博客的基础上，结合实际业务情况及个人感受进行编写，特别感谢博主贴：
  《五步轻松设计出用户操作日志-产品乱弹》
  《操作日志设计详解——最后的甩锅证据-司马特小分队》
  ```
